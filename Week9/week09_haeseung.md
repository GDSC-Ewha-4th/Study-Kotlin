# Kotlin in Action Chap.9 QnAπ”

## #****Start Projection : νƒ€μ… μΈμ λ€μ‹  * μ‚¬μ©****

μ λ„¤λ¦­ νƒ€μ… μΈμ μ •λ³΄κ°€ μ—†μμ„ ν‘ν„ν•κΈ° μ„ν•΄Β **Star Projection**μ„ μ‚¬μ©ν•  μ μκ³ , μ΄λ” `List<*>`μ™€ κ°™μ΄ μ‚¬μ© κ°€λ¥ν•λ‹¤.

μ²«μ§Έ, MutableList<>λ” `MutableList<Any?>`*μ™€ **κ°™μ§€ μ•λ‹¤**.* `MutableList<Any?>`λ” λ¨λ“  νƒ€μ…μ μ›μ†λ¥Ό λ‹΄μ„ μ μλ‹¤λ” μ‚¬μ‹¤μ„ μ• μ μλ” λ¦¬μ¤νΈλ‹¤. λ°λ©΄ `MutableList<*>`λ” μ–΄λ–¤ μ •ν•΄μ§„ κµ¬μ²΄μ μΈ νƒ€μ…μ μ›μ†λ§μ„ λ‹΄λ” λ¦¬μ¤νΈμ§€λ§ κ·Έ μ›μ†μ νƒ€μ…μ„ μ •ν™•ν λ¨λ¥Έλ‹¤λ” λ»μ΄λ‹¤.

```kotlin
>>> val list: MutableList<Any?> = mutableListOf('a', 1, "qwe")
>>> val chars = mutableListOf('a', 'b', 'c')
>>> val unknownElements: MutableList<*> =                
...         if (Random().nextBoolean()) list else chars
>>> unknownElements.add(42) // μ»΄νμΌλ¬λ” μ΄ λ©”μ†λ“ νΈμ¶μ„ κΈμ§€ν•λ‹¤.                              
Error: Out-projected type 'MutableList<*>' prohibits
the use of 'fun add(element: E): Boolean'
>>> println(unknownElements.first()) // μ›μ†λ¥Ό κ°€μ Έμ™€λ„ μ•μ „ν•λ‹¤. first()λ” Any? νƒ€μ…μ μ›μ†λ¥Ό λ°ν™ν•λ‹¤. 
a
```

μ„μ μμ‹μ—μ„ μ»΄νμΌλ¬λ”Β `MutableList<*>`λ¥Ό μ•„μ›ƒ ν”„λ΅μ μ… νƒ€μ…μΌλ΅ μΈμ‹ν•λ”λ°, μ—¬κΈ°μ„μ `MutableList<*>`λ”Β `MutableList<out Any?>`μ™€ λ™μΌν•κ² λ™μ‘ν•λ‹¤. μ–΄λ–¤ λ¦¬μ¤νΈμ μ›μ† νƒ€μ…μ„ λ¨λ¥΄λ”λΌλ„ κ·Έ λ¦¬μ¤νΈμ—μ„ μ•μ „ν•κ² `Any?` νƒ€μ…μ„ κΊΌλ‚΄μ¤λ” κ²ƒμ€ κ°€λ¥ν•μ§€λ§, νƒ€μ…μ„ λ¨λ¥΄λ” λ¦¬μ¤νΈμ— μ›μ†λ¥Ό λ§μλ€λ΅ λ„£λ” κ²ƒμ€ λ¶κ°€λ¥ν•λ‹¤.

## #****μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°(Reified type parameters)****

****μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°****λ¥Ό μ‚¬μ©ν•λ©΄ λ°νƒ€μ„μ— μΈλΌμΈ ν•¨μ νΈμ¶μ—μ„ νƒ€μ… μΈμλ΅ μ‚¬μ©λλ” νΉμ • ν•μ‹μ„ μ°Έμ΅°ν•  μ μλ‹¤. (μΌλ° ν΄λμ¤λ‚ ν•¨μμ κ²½μ°, ν•μ‹ μΈμλ” λ°νƒ€μ„μ— μ§€μ›μ§€κΈ° λ•λ¬Έμ— μ΄ μ‘μ—…μ€ λ¶κ°€λ¥ν•λ‹¤.)

μ¦‰, Reified ν‚¤μ›λ“λ¥Ό μ‚¬μ©ν•λ©΄ Generics functionμ—μ„ Runtimeμ— νƒ€μ… μ •λ³΄λ¥Ό μ• μ μλ‹¤. ν•μ§€λ§ inline functionκ³Ό ν•¨κ» μ‚¬μ©ν•  λ•λ§ κ°€λ¥ν•λ‹¤.

## #****reified νƒ€μ… νλΌλ―Έν„°μ μ μ•½****

reified νƒ€μ… νλΌλ―Έν„°λ” λ§¤μ° μ μ©ν• λ„κµ¬μ΄μ§€λ§, μ΄μ—λ„ μ μ•½μ΄ μ΅΄μ¬ν•λ‹¤. 

**reified νƒ€μ… νλΌλ―Έν„°λ” λ‹¤μκ³Ό κ°™μ€ κ²½μ° μ‚¬μ©ν•  μ μλ‹¤.**

- νƒ€μ… κ²€μ‚¬μ™€ μΊμ¤ν… (`is,!is,as,as?`)
- 10μ¥μ—μ„ μ„¤λ…ν•  μ½”ν‹€λ¦° λ¦¬ν”λ ‰μ… API(`::class`)
- μ½”ν‹€λ¦° νƒ€μ…μ— λ€μ‘ν•λ” `java.lang.Class` μ–»κΈ° (`::class.java`)
- λ‹¤λ¥Έ ν•¨μλ¥Ό νΈμ¶ν•  λ• νƒ€μ… μΈμλ΅ μ‚¬μ©

**ν•μ§€λ§ λ‹¤μκ³Ό κ°™μ€ μ‘μ—…μ€ λ¶κ°€λ¥**

- νƒ€μ… νλΌλ―Έν„° ν΄λμ¤μ μΈμ¤ν„΄μ¤ μƒμ„±ν•κΈ°
- νƒ€μ… νλΌλ―Έν„° ν΄λμ¤μ λ™λ° κ°μ²΄ λ©”μ†λ“ νΈμ¶ν•κΈ°
- reified νƒ€μ… νλΌλ―Έν„°λ¥Ό μ”κµ¬ν•λ” ν•¨μλ¥Ό νΈμ¶ν•λ©΄μ„ reified ν•μ§€ μ•μ€ νƒ€μ… νλΌλ―Έν„°λ΅ λ°›μ€ νƒ€μ…μ„ νƒ€μ… μΈμλ΅ λ„κΈ°κΈ°
- ν΄λμ¤, ν”„λ΅νΌν‹°, μΈλΌμΈ ν•¨μκ°€ μ•„λ‹ ν•¨μμ νƒ€μ… νλΌλ―Έν„°λ¥Ό reifiedλ΅ μ§€μ •ν•κΈ°

reifiedκ°€ μΈλΌμΈ ν•¨μμ—λ§ μ‚¬μ©ν•  μ μκΈ° λ•λ¬Έμ—, reifiedλ¥Ό μ‚¬μ©ν•λ©΄ λ¬΄μ΅°κ±΄ λλ‹¤κ°€ μΈλΌμ΄λ‹μ΄ λλ‹¤. λ”°λΌμ„ λλ‹¤λ¥Ό μΈλΌμ΄λ‹ν•κ³  μ‹¶μ§€ μ•μ€ κ²½μ°μ—λ” `noinline` ν‚¤μ›λ“λ¥Ό μ“Έ μ μλ‹¤.

## #λ¬΄κ³µλ³€(invariance) : νƒ€μ… κ΄€κ³„ μ—†μ

λ¬΄κ³µλ³€(invariance)μ΄λ€,Β **νƒ€μ… Sκ°€ Tμ ν•μ„ νƒ€μ…μΌ λ•, Box[S]μ™€ Box[T] μ‚¬μ΄μ— μƒμ† κ΄€κ³„κ°€ μ—†λ” κ²ƒ**μ„ λ‚νƒ€λ‚Έλ‹¤.

## #****covariant(κ³µλ³€μ„±) : ν•μ„ νƒ€μ… κ΄€κ³„ μ μ§€****

κ³µλ³€(covariance)λ”Β **νƒ€μ… Sκ°€ Tμ ν•μ„ νƒ€μ…μΌ λ•, Box[S]κ°€ Box[T]μ ν•μ„ νƒ€μ…**Β μ„μ„ λ‚νƒ€λ‚΄λ” κ°λ…μ΄λ‹¤. μ΄λ¥Ό κ³µλ³€ κ΄€κ³„κ°€ μ μ§€λλ‹¤κ³  λ§ν•λ‹¤. μ½”ν‹€λ¦°μ—μ„λ” κ³µλ³€μ„ <out T>λ΅ μ„ μ–Έν•λ©΄ λ©λ‹λ‹¤.

## #****contravariance(λ°κ³µλ³€) : λ’¤μ§‘ν ν•μ„ νƒ€μ… κ΄€κ³„****

λ°κ³µλ³€(contravariance)μ€Β **νƒ€μ… Sκ°€ Tμ ν•μ„ νƒ€μ…μΌ λ•, Box[S]κ°€ Box[T]μ μƒμ„ νƒ€μ…**μ„μ„ λ‚νƒ€λ‚΄λ” κ°λ…μ΄λ‹¤.

## #inκ³Ό out μ„μΉ

κ·Έλ°λ° μ•„λ¬΄ ν΄λμ¤λ‚ κ³µλ³€μ μΌλ΅ λ§λ“ λ‹¤λ©΄ κµ‰μ¥ν λ¶μ•μ •ν•΄μ§ κ²ƒμ΄λ‹¤. νƒ€μ… μ•μ •μ„±μ„ λ³΄μ¥ν•κΈ° μ„ν•΄μ„ ν΄λμ¤μ λ§΄λ²„λ¥Ό `in`κ³Ό `out` ν¬μ§€μ…μΌλ΅ λ‚λ„μ–΄μ•Ό ν•λ‹¤.

μ¦‰, ν΄λμ¤ λ©¤λ²„λ¥Ό μ„ μ–Έν•  λ• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•  μ μλ” μ§€μ μ€ λ¨λ‘ `μΈ(in)`κ³Ό `μ•„μ›ƒ(out)`μ„μΉλ΅ λ‚λ‰λ‹¤. λ§μ•½ Tκ°€ ν•¨μμ λ°ν™ νƒ€μ…μ— μ“°μΈλ‹¤λ©΄ Tλ” `μ•„μ›ƒ` μ„μΉμ— μλ‹¤. κ·Έ ν•¨μλ” T νƒ€μ…μ κ°’μ„ μƒμ‚°ν•λ‹¤. Tκ°€ ν•¨μμ νλΌλ―Έν„° νƒ€μ…μ— μ“°μΈλ‹¤λ©΄ Tλ” `μΈ` μ„μΉμ— μλ‹¤.

| covariant, κ³µλ³€μ„± | contravariance, λ°κ³µλ³€μ„± | invariant, λ¬΄κ³µλ³€ |
| --- | --- | --- |
| Producer<out T> | Consumer<in T> | MutableList |
| νƒ€μ… μΈμμ subtype κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μ—μ„λ„ μ μ§€ | νƒ€μ… μΈμμ subtype κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μ—μ„ μ—­μ „ | subtype κ΄€κ³„ μ„±λ¦½ μ•ν•¨ |
| Producer<Cat>μ€Β Producer<Animal>μ subtype | Consumer<Animal>μ€Β Consumer<Cat>μ subtype |  |
| Tλ¥Ό outμ„μΉμ—λ§ μ‚¬μ© κ°€λ¥
(λ°ν™ νƒ€μ…μ—μ„λ§ μ‚¬μ©) | Tλ¥Ό inμ„μΉμ—λ§ μ‚¬μ© κ°€λ¥
(νλΌλ―Έν„° μ„μΉμ—λ§ μ‚¬μ©) | Tλ¥Ό μ•„λ¬΄λ°λ‚ μ‚¬μ© κ°€λ¥
(μ¦‰, λ°ν™κ³Ό νλΌλ―Έν„°μ—μ„ μ‚¬μ©) |